<!DOCTYPE HTML>
<html>
<head lang="en">
    <title>Dmynerd's Countdown Generator v1.0.3</title>
    <meta charset="UTF-8">
    <meta name="author" content="Dmynerd78">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="background: #fff !important;">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: Verdana, Arial, Helvetica, sans-serif;
        }

        body {
            display: flex;
            justify-content: center; /* align horizontal */
            align-items: center; /* align vertical */
        }

        h1, h2, h3, h4, h5 { margin-bottom: 5px; }
        input { margin-top: 5px; }
        a:visited { color: blue; }

        #form {
            text-align: center;
            margin: 5%;
            height: 100%;
        }

        #countdownURL {
            color: firebrick;
            word-wrap: break-word;
        }

        #countdown { font-size: 200px; }

        .flash {
            animation-name: animFlash;
            animation-iteration-count: infinite;
        }

        @keyframes animFlash {
            0%   {opacity:1;}
            25%   {opacity:1;}
            26%   {opacity:0;}
            75%  {opacity:0;}
            76%  {opacity:1;}
            100% {opacity:1;}
        }

    </style>
    <span id="countdown"></span>
    <div id="form">
        <h1>Dmynerd's Countdown Generator v1.0.3</h1>
        <h2>If you are seeing this in your preview then you did something wrong!</h2>
        <p>Please fill in any variables that you would like to change then hit <b>Generate Countdown URL</b> to get the URL.</p>
        <br />

        <h2>Minutes</h2>
        <span>Amount of minutes</span>
        <br />
        <input type="text" name="minutes" placeholder="1" autofocus />
        <br />

        <h2>Seconds</h2>
        <span>Amount of seconds</span>
        <br />
        <input type="text" name="seconds" placeholder="00" />
        <br />

        <h2>Background Color</h2>
        <span>
            Color of the background using hexidecimal, rgb, rgba, etc.
            <br />
            <a href="https://www.w3schools.com/colors/colors_picker.asp" target="_blank">Use this if you are confused</a>
            <br />
            <a href="http://www.colorzilla.com/gradient-editor/" target="_blank">You can also use gradients</a><span>. Just copy *-gradient line (but don't copy the semi-colon)</span>
        </span>
        <br />
        <input type="text" name="bgColor" placeholder="rgba(0,0,0,0)" />
        <br />

        <h2>Countdown Text Color</h2>
        <span>
            Color of the countdown text using hexidecimal, rgb, rgba, etc.
            <br />
            <a href="https://www.w3schools.com/colors/colors_picker.asp" target="_blank">Use this if you are confused</a>
        </span>
        <br />
        <input type="text" name="fgColor" placeholder="#000000" />
        <br />

        <h2>Countdown Text Font</h2>
        <span>
            Choose a font that is installed onto your PC.
            <br />
            Example fonts:  <u>Times New Romans</u>, <u>Comic Sans MS</u>, and <u>Impact</u>
        </span>
        <br />
        <input type="text" name="font" placeholder="Arial" />
        <br />

        <h2>Flashing Text</h2>
        <span>The countdown text flashes once it reaches zero</span>
        <br />
        <input type="text" name="flash" placeholder="true" />
        <br />

        <h2>Flashing Duration</h2>
        <span>The amount of time the text will be displayed before being hidden again in seconds</span>
        <br />
        <input type="text" name="fDuration" placeholder="1" />
        <br />
        <br />

        <button onclick="genURL();">Generate Countdown URL</button>
        <div id="countdownSpans" style="display: none;">
            <br />
            <br />
            <span>Place this URL in OBS/XSplit:</span>
            <br />
            <span id="countdownURL"></span>
        </div>
    </div>
    <script>
        // Possibly use FitText?


        if(window.location.search == "") {
            console.error("No arguments given, showing form instead of countdown");
            document.querySelector("#countdown").setAttribute("style", "display: none;");
        } else {
            console.log("Arguments given - getting params...");
            document.querySelector("#form").setAttribute("style", "display: none;");
            args = decodeURIComponent(window.location.search.slice(1)).split("&");
            console.log(args);

            params = {};
            for(x=0; x<args.length; x++) {
                argCurrent = args[x].split("=");

                params[argCurrent[0]] = argCurrent[1];
            }

            createCountdown(params);
        }

        function getInputVal(selector) {
            val = document.querySelector("input[name=" + selector + "]").value;
            if(val == "") {
                val = document.querySelector("input[name=" + selector + "]").placeholder;
            }

            return val;
        }

        function genURL() {
            params = "minutes=" + getInputVal("minutes") +
                     "&seconds=" +  getInputVal("seconds") +
                     "&bgColor=" +  getInputVal("bgColor") +
                     "&fgColor=" +  getInputVal("fgColor") +
                     "&font=" +  getInputVal("font") +
                     "&flash=" +  getInputVal("flash") +
                     "&fDuration=" +  getInputVal("fDuration");

            document.querySelector("#countdownURL").textContent = document.location.origin + document.location.pathname + "?" + encodeURIComponent(params);
            document.querySelector("#countdownSpans").setAttribute("style", "");
        }

        function createCountdown(params) {
            document.querySelector("body").setAttribute("style", "background:" + params["bgColor"] + "!important;"); // Used important since OBS defaults to transparent
            document.querySelector("#countdown").setAttribute("style", "color:" + params["fgColor"] + "; font-family:'" + params["font"] + "'; animation-duration: " + params["fDuration"] + "s;");

            timer = parseInt(params["minutes"]) * 60 + parseInt(params["seconds"]);

            window._timer = timer;
            window._params = params;

            tDuration = setInterval(function(params, timer) { // params and timer not passed as args? Switched to global vars and it worked
                minutes = parseInt( window._timer / 60, 10);
                if(minutes < 10) { minutes = ("0" + minutes).slice(-2) };
                seconds = parseInt( window._timer % 60, 10);
                if(seconds < 10) { seconds = ("0" + seconds).slice(-2) };
                strTime = minutes + ":" + seconds;
                document.querySelector("#countdown").textContent = strTime;

                if (--window._timer < 0) {
                    console.log("Countdown reached 0");
                    clearInterval(tDuration);
                    if(window._params["flash"].toLowerCase() == "true") {
                        document.querySelector("#countdown").className += " flash";
                    }
                }

            }, 1000);

        }
    </script>
</body>
</html>
